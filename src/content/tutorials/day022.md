---
day: Day 22
title: L-Systemã«ã‚ˆã‚‹åˆ†å²æ§‹é€ ã®ç”Ÿæˆ
difficulty: 4.0
tags: [recursive, tree, 3d]
---

## âœ… Inputs

- axiom: str â€“ åˆæœŸæ–‡å­—åˆ—ï¼ˆä¾‹: "F"ï¼‰
- rules: dict â€“ æ›¸ãæ›ãˆãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹: {"F": "F[+F]F[-F]F"}ï¼‰
- angle: float â€“ å›è»¢è§’åº¦ï¼ˆåº¦å˜ä½ã€ã™ã¹ã¦ã®å›è»¢ã«å…±é€šï¼‰
- length: float â€“ å„æã®é•·ã•
- depth: int â€“ ãƒ«ãƒ¼ãƒ«å±•é–‹ã®åå¾©å›æ•°ï¼ˆä¸–ä»£æ•°ï¼‰
- pipe_radius: float â€“ Pipeã®å¤ªã•ï¼ˆç·šã‚’å¤ªãå¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®è¨­å®šï¼‰

## âœ… Outputs

- results: list of Brep â€“ L-Systemã«å¾“ã£ã¦ç”Ÿæˆã•ã‚ŒãŸåˆ†å²æ§‹é€ ã‚’Pipeã§å¯è¦–åŒ–ã—ãŸå½¢çŠ¶ç¾¤

## âœ… Code

```python
import Rhino.Geometry as rg
import math

# === ğŸ”§ å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¾‹ ===
axiom = "F"
rules = {"F": "F[+F]F[-F]F"}  # F = Forwardï¼ˆæã‚’ä¼¸ã°ã™ï¼‰
angle = 40.5   # åº¦å˜ä½
length = 10.0
depth = 4
pipe_radius = 0.5

# === ğŸ§­ ã‚³ãƒãƒ³ãƒ‰ã®æ„å‘³ï¼ˆè¨˜å·ã®ãƒãƒƒãƒ”ãƒ³ã‚°è¡¨ï¼‰
# command_meanings = {
#     "F": "å‰é€²ã—ã¦ç·šã‚’æãï¼ˆForwardï¼‰",
#     "+": "å·¦ã«å›è»¢ï¼ˆZè»¸ï¼‰",
#     "-": "å³ã«å›è»¢ï¼ˆZè»¸ï¼‰",
#     "&": "ä¸‹ã«å›è»¢ï¼ˆXè»¸ï¼‰",
#     "^": "ä¸Šã«å›è»¢ï¼ˆXè»¸ï¼‰",
#     "\\": "å·¦ã«ãƒ­ãƒ¼ãƒ«ï¼ˆé€²è¡Œæ–¹å‘è»¸ï¼‰",
#     "/": "å³ã«ãƒ­ãƒ¼ãƒ«ï¼ˆé€²è¡Œæ–¹å‘è»¸ï¼‰",
#     "[": "ç¾åœ¨ã®ä½ç½®ã¨å‘ãã‚’ä¿å­˜",
#     "]": "ä¿å­˜ã—ãŸçŠ¶æ…‹ã«æˆ»ã™"
# }

# === ğŸ§¬ L-Systemã®å±•é–‹
def expand_lsystem(axiom, rules, depth):
    result = axiom
    for _ in range(depth):
        next_result = ""
        for char in result:
            next_result += rules.get(char, char)
        result = next_result
    return result

# === ğŸ¢ Turtleæç”»ï¼ˆ3Dãƒ™ãƒ¼ã‚¹ï¼‰
def interpret_lsystem(lsys_string, angle_deg, length):
    pos_stack = []
    dir_stack = []

    pos = rg.Point3d(0, 0, 0)
    dir = rg.Vector3d(0, 0, 1)  # Zæ–¹å‘ã«æˆé•·
    up = rg.Vector3d(1, 0, 0)
    right = rg.Vector3d(0, 1, 0)

    lines = []
    angle_rad = math.radians(angle_deg)
    xform_stack = []

    for char in lsys_string:
        if char == "F":  # Forward
            new_pos = pos + dir * length
            lines.append(rg.Line(pos, new_pos))
            pos = new_pos
        elif char == "+":  # å·¦ã«å›è»¢ï¼ˆZè»¸ï¼‰
            xform = rg.Transform.Rotation(angle_rad, up, pos)
            dir.Transform(xform)
        elif char == "-":  # å³ã«å›è»¢ï¼ˆZè»¸ï¼‰
            xform = rg.Transform.Rotation(-angle_rad, up, pos)
            dir.Transform(xform)
        elif char == "&":  # ä¸‹ã«å›è»¢ï¼ˆXè»¸ï¼‰
            xform = rg.Transform.Rotation(angle_rad, right, pos)
            dir.Transform(xform)
        elif char == "^":  # ä¸Šã«å›è»¢ï¼ˆXè»¸ï¼‰
            xform = rg.Transform.Rotation(-angle_rad, right, pos)
            dir.Transform(xform)
        elif char == "\\":  # å·¦ãƒ­ãƒ¼ãƒ«ï¼ˆZè»¸ã‚’ã­ã˜ã‚‹ï¼‰
            xform = rg.Transform.Rotation(angle_rad, dir, pos)
            up.Transform(xform)
            right.Transform(xform)
        elif char == "/":  # å³ãƒ­ãƒ¼ãƒ«
            xform = rg.Transform.Rotation(-angle_rad, dir, pos)
            up.Transform(xform)
            right.Transform(xform)
        elif char == "[":  # çŠ¶æ…‹ä¿å­˜
            pos_stack.append(rg.Point3d(pos))
            dir_stack.append(rg.Vector3d(dir))
            xform_stack.append((rg.Vector3d(up), rg.Vector3d(right)))
        elif char == "]":  # çŠ¶æ…‹å¾©å…ƒ
            if pos_stack and dir_stack:
                pos = pos_stack.pop()
                dir = dir_stack.pop()
                up, right = xform_stack.pop()

    return [l.ToNurbsCurve() for l in lines]

# === ğŸš€ å®Ÿè¡Œ
lsys_string = expand_lsystem(axiom, rules, depth)
curves = interpret_lsystem(lsys_string, angle, length)

results = []
for c in curves:
    pipes = rg.Brep.CreatePipe(c, pipe_radius, False, rg.PipeCapMode.Round, True, 0.001, 0.001)
    if pipes:
        results.extend(pipes)
```